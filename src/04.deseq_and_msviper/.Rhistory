# DESeq2
deseq_results <- list()
idx1 = 1
for (idx1 in seq(length(sorted_conditions)-1)) {
idx2 <- idx1 + 1
samples1 <- samples_in_conditions[[sorted_conditions[idx1]]]
samples2 <- samples_in_conditions[[sorted_conditions[idx2]]]
# Subset the counts matrix based on the input samples
counts_matrix1 <- counts_matrix[,samples1,drop=FALSE]
counts_matrix2 <- counts_matrix[,samples2,drop=FALSE]
# Customize the template and cts for sw1_samples
template_df1 <- template_df[samples1, c('Dataset', 'Sex'), drop=FALSE]
key1 <- 'SW1'
template_df1$sample_id <- paste(key1, seq(1,length(samples1)), sep='_')
template_df1$condition <- rep(key1, length(samples1))
template_df1 <- adjust_batch(template_df1)
colnames(counts_matrix1) = template_df1$sample_id
# Customize the template and cts for sw2_samples
template_df2 <- template_df[samples2, c('Dataset', 'Sex'), drop=FALSE]
key2 <- 'SW2'
template_df2$sample_id <- paste(key2, seq(1,length(samples2)), sep='_')
template_df2$condition <- rep(key2, length(samples2))
template_df2 <- adjust_batch(template_df2)
colnames(counts_matrix2) = template_df2$sample_id
# Concatenate the count matrices and templates
combined_counts_matrix = cbind(counts_matrix1, counts_matrix2)
coldata = rbind(template_df1, template_df2)
rownames(coldata) <- NULL
coldata$condition <- as.factor(coldata$condition)
# Factorization of variables
coldata$batch_id <- paste0(coldata$Dataset, coldata$Sex)
coldata$batch_id <- as.factor(coldata$batch_id)
# Run DESeq and get the results
dds <- DESeqDataSetFromMatrix(countData = combined_counts_matrix,
colData = coldata,
design = ~ batch_id + condition)
dds$condition <- relevel(dds$condition, ref = key1)
dds <- DESeq(dds, parallel=FALSE)
res <- results(dds, cooksCutoff = FALSE)
res <- as.data.frame(res)
res <- res[!is.na(res$padj),]
res <- res[,c('log2FoldChange', 'pvalue', 'padj')]
key <- paste(sorted_conditions[idx2], '_vs_', sorted_conditions[idx1], sep='')
colnames(res) <- paste(key, colnames(res), sep='_')
deseq_results[[key]] <- res
}
final_df <- data.frame(genes=rownames(deseq_results[[1]]))
rownames(final_df) <- final_df$genes
for (df in deseq_results) {
final_df <- merge(final_df, df, by=0, all=TRUE)
row.names(final_df) <- final_df$Row.names
final_df$Row.names <- NULL
}
final_df$genes <- NULL
idx <- grep('padj',colnames(final_df))
final_df[,idx][is.na(final_df[,idx])] <- 1
idx <- grep('pvalue',colnames(final_df))
final_df[,idx][is.na(final_df[,idx])] <- 1
idx <- grep('log',colnames(final_df))
final_df[,idx][is.na(final_df[,idx])] <- 0
ensembl_mapping <- read.table('../../data/ensembl_mapping.tsv', sep='\t')
ensembl_mapping[,1] <- NULL
colnames(ensembl_mapping) <- c('ensembl_gene_id', 'external_gene_name')
final_df <- merge(final_df, ensembl_mapping, by.x=0, by.y='ensembl_gene_id',
all.x=TRUE, all.y=FALSE)
colnames(final_df)[1] <- 'ensembl_gene_id'
write.table(final_df, file = paste(output_dir, '/deseq_results.csv', sep=''), sep=',')
}
output_dir = '../../results_ucam_sanyal2/discrete_analysis/SAF_score/'
deseq_worker(sorted_conditions, samples_in_conditions, output_dir)
# appropriately
#
#
# 2A. Get only the log2fc values and remove duplicated gene symbols by averaging
# their logfcs
#
# 2B. Get only the adjusted pvalues and remove duplicated gene symbols. To
# do that, calculate the mean log10(adj.pvalue) and create a new row
#
################################################################################
de_analysis_df <- read.csv(paste(output_dir,'deseq_results.csv', sep=''), row.names=1, sep=',')
de_analysis_df <- de_analysis_df[!de_analysis_df$external_gene_name == "",]
# 2A
columns <- colnames(de_analysis_df)[grepl(x=colnames(de_analysis_df), pattern='log2')]
logfc_df <- de_analysis_df[,c(columns,'external_gene_name')]
logfc_df[is.na(logfc_df)] <- 0
logfc_df <- logfc_df[!logfc_df$external_gene_name == "",]
logfc_df <- logfc_df %>%
group_by(external_gene_name) %>%
select(-external_gene_name) %>%
summarise_if(is.numeric, mean)
logfc_df <- as.data.frame(logfc_df)
rownames(logfc_df) <- logfc_df$external_gene_name
logfc_df$external_gene_name <- NULL
colnames(logfc_df) <- c('Mild_vs_Control', 'Moderate_vs_Mild', 'Severe_vs_Moderate')
dim(logfc_df)
# 2B
columns <- colnames(de_analysis_df)[grepl(x=colnames(de_analysis_df), pattern='padj')]
adj_pvalues_df <- de_analysis_df[,c(columns,'external_gene_name')]
adj_pvalues_df[is.na(adj_pvalues_df)] <- 1
adj_pvalues_df <- adj_pvalues_df[!adj_pvalues_df$external_gene_name == "",]
adj_pvalues_df <- adj_pvalues_df %>%
group_by(external_gene_name) %>%
select(-external_gene_name) %>%
summarise_if(is.numeric, pvalue_transformation)
adj_pvalues_df <- as.data.frame(adj_pvalues_df)
rownames(adj_pvalues_df) <- adj_pvalues_df$external_gene_name
adj_pvalues_df$external_gene_name <- NULL
colnames(adj_pvalues_df) <- c('Mild_vs_Control', 'Moderate_vs_Mild', 'Severe_vs_Moderate')
dim(adj_pvalues_df)
Regulon_file<- read.csv("../../data/collectTRI_network.tsv", sep='\t', header=T)
background_genes <- intersect(modules_genes, rownames(adj_pvalues_df))
# 1A. Get the significant modules
filename <- paste(modules_dir, 'module_variable_coefficients_FINAL.tsv', sep='')
modules_per_var_df <- read.table(filename, sep='\t', header=TRUE)
modules_per_var_df <- modules_per_var_df[modules_per_var_df$p.value_adjust < 0.05,]
modules_per_var_df <- modules_per_var_df[!modules_per_var_df$term %in% c('age', 'inflammation'),]
# 1B. Get their gene sets
filename <- paste(modules_dir, 'filtered_modules.tsv',sep='')
modules_df <- read.table(filename, sep='\t', header=TRUE)
modules_gene_sets <- split(x=modules_df$gene_symbol, f=modules_df$module_color)
for (module in names(modules_gene_sets)) {
if (!(module %in% modules_per_var_df$term)) {
modules_gene_sets[[module]] <- NULL
}
}
modules_genes <- unique(unlist(modules_gene_sets))
length(modules_genes)
background_genes <- intersect(modules_genes, rownames(adj_pvalues_df))
length(background_genes)
final_adj_pvalues_df <- adj_pvalues_df[background_genes, ]
final_logfc_df <- logfc_df[background_genes, ]
# 4A
discrete_stages = colnames(final_logfc_df)
msviper_results_list <- list()
for (stage in discrete_stages) {
# Step 1: construct the gene signature for msviper
stage_df <- merge(final_adj_pvalues_df[,stage,drop=FALSE],
final_logfc_df[,stage,drop=FALSE],
by.x=0, by.y=0)
colnames(stage_df) <- c('gene_symbol', 'padj', 'logfc')
rownames(stage_df) <- stage_df$gene_symbol
stage_df$gene_symbol <- NULL
signature <- stage_df[,'padj',drop=TRUE]
signature <- qnorm(signature/2, lower.tail = FALSE)*sign(stage_df[,'logfc',drop=TRUE])
names(signature) <- rownames(stage_df)
# Step 2: Run msviper and save the results
msviper_results_df <- calculate_tf_activities(signature)
msviper_results_list[[stage]] <- msviper_results_df
}
################################################################################
# Performs msviper using the results of differential expreesional analysis in
# in the previous step
################################################################################
msviper_worker <- function(adj_pvalues_df, logfc_df, output_dir) {
background_genes <- intersect(modules_genes, rownames(adj_pvalues_df))
length(background_genes)
final_adj_pvalues_df <- adj_pvalues_df[background_genes, ]
final_logfc_df <- logfc_df[background_genes, ]
discrete_stages = colnames(final_logfc_df)
msviper_results_list <- list()
for (stage in discrete_stages) {
stage_df <- merge(final_adj_pvalues_df[,stage, drop=FALSE],
final_logfc_df[,stage, drop=FALSE],
by.x=0, by.y=0)
colnames(stage_df) <- c('gene_symbol', 'padj', 'logfc')
rownames(stage_df) <- stage_df$gene_symbol
stage_df$gene_symbol <- NULL
signature <- stage_df[,'padj',drop=TRUE]
signature <- qnorm(signature/2, lower.tail = FALSE)*sign(stage_df[,'logfc',drop=TRUE])
names(signature) <- rownames(stage_df)
msviper_results_df <- calculate_tf_activities(signature)
msviper_results_list[[stage]] <- msviper_results_df
}
msviper_results_df <- data.frame(tf=unique(Regulon_file$tf))
rownames(msviper_results_df) <- msviper_results_df$tf
for (stage in names(msviper_results_list)) {
tmp <- msviper_results_list[[stage]][,c('nes', 'fdr'),drop=FALSE]
colnames(tmp) <- paste(colnames(tmp), c(stage), sep='_')
msviper_results_df <- merge(msviper_results_df, tmp,
by.x=0, by.y=0, all=TRUE)
rownames(msviper_results_df) <- msviper_results_df$Row.names
msviper_results_df$Row.names <- NULL
}
msviper_results_df[is.na(msviper_results_df)] <- 1
msviper_results_df$tf <- NULL
filename <- paste(output_dir, 'tf_results.tsv', sep='')
write.table(msviper_results_df, file = filename, quote = FALSE, sep='\t')
}
################################################################################
# Performs deseq2 for a pre-defined sequence of conditions and their sample
# sets
################################################################################
deseq_worker <- function(sorted_conditions, samples_in_conditions, output_dir) {
dir.create(output_dir, showWarnings = FALSE, recursive = TRUE)
# DESeq2
deseq_results <- list()
idx1 = 1
for (idx1 in seq(length(sorted_conditions)-1)) {
idx2 <- idx1 + 1
samples1 <- samples_in_conditions[[sorted_conditions[idx1]]]
samples2 <- samples_in_conditions[[sorted_conditions[idx2]]]
# Subset the counts matrix based on the input samples
counts_matrix1 <- counts_matrix[,samples1,drop=FALSE]
counts_matrix2 <- counts_matrix[,samples2,drop=FALSE]
# Customize the template and cts for sw1_samples
template_df1 <- template_df[samples1, c('Dataset', 'Sex'), drop=FALSE]
key1 <- 'SW1'
template_df1$sample_id <- paste(key1, seq(1,length(samples1)), sep='_')
template_df1$condition <- rep(key1, length(samples1))
template_df1 <- adjust_batch(template_df1)
colnames(counts_matrix1) = template_df1$sample_id
# Customize the template and cts for sw2_samples
template_df2 <- template_df[samples2, c('Dataset', 'Sex'), drop=FALSE]
key2 <- 'SW2'
template_df2$sample_id <- paste(key2, seq(1,length(samples2)), sep='_')
template_df2$condition <- rep(key2, length(samples2))
template_df2 <- adjust_batch(template_df2)
colnames(counts_matrix2) = template_df2$sample_id
# Concatenate the count matrices and templates
combined_counts_matrix = cbind(counts_matrix1, counts_matrix2)
coldata = rbind(template_df1, template_df2)
rownames(coldata) <- NULL
coldata$condition <- as.factor(coldata$condition)
# Factorization of variables
coldata$batch_id <- paste0(coldata$Dataset, coldata$Sex)
coldata$batch_id <- as.factor(coldata$batch_id)
# Run DESeq and get the results
dds <- DESeqDataSetFromMatrix(countData = combined_counts_matrix,
colData = coldata,
design = ~ batch_id + condition)
dds$condition <- relevel(dds$condition, ref = key1)
dds <- DESeq(dds, parallel=FALSE)
res <- results(dds, cooksCutoff = FALSE)
res <- as.data.frame(res)
res <- res[!is.na(res$padj),]
res <- res[,c('log2FoldChange', 'pvalue', 'padj')]
key <- paste(sorted_conditions[idx2], '_vs_', sorted_conditions[idx1], sep='')
colnames(res) <- paste(key, colnames(res), sep='_')
deseq_results[[key]] <- res
}
final_df <- data.frame(genes=rownames(deseq_results[[1]]))
rownames(final_df) <- final_df$genes
for (df in deseq_results) {
final_df <- merge(final_df, df, by=0, all=TRUE)
row.names(final_df) <- final_df$Row.names
final_df$Row.names <- NULL
}
final_df$genes <- NULL
idx <- grep('padj',colnames(final_df))
final_df[,idx][is.na(final_df[,idx])] <- 1
idx <- grep('pvalue',colnames(final_df))
final_df[,idx][is.na(final_df[,idx])] <- 1
idx <- grep('log',colnames(final_df))
final_df[,idx][is.na(final_df[,idx])] <- 0
ensembl_mapping <- read.table('../../data/ensembl_mapping.tsv', sep='\t')
ensembl_mapping[,1] <- NULL
colnames(ensembl_mapping) <- c('ensembl_gene_id', 'external_gene_name')
final_df <- merge(final_df, ensembl_mapping, by.x=0, by.y='ensembl_gene_id',
all.x=TRUE, all.y=FALSE)
colnames(final_df)[1] <- 'ensembl_gene_id'
write.table(final_df, file = paste(output_dir, '/deseq_results.csv', sep=''), sep=',')
}
################################################################################
# Performs msviper using the results of differential expreesional analysis in
# in the previous step
################################################################################
msviper_worker <- function(adj_pvalues_df, logfc_df, output_dir) {
background_genes <- intersect(modules_genes, rownames(adj_pvalues_df))
length(background_genes)
final_adj_pvalues_df <- adj_pvalues_df[background_genes, ]
final_logfc_df <- logfc_df[background_genes, ]
discrete_stages = colnames(final_logfc_df)
msviper_results_list <- list()
for (stage in discrete_stages) {
stage_df <- merge(final_adj_pvalues_df[,stage, drop=FALSE],
final_logfc_df[,stage, drop=FALSE],
by.x=0, by.y=0)
colnames(stage_df) <- c('gene_symbol', 'padj', 'logfc')
rownames(stage_df) <- stage_df$gene_symbol
stage_df$gene_symbol <- NULL
signature <- stage_df[,'padj',drop=TRUE]
signature <- qnorm(signature/2, lower.tail = FALSE)*sign(stage_df[,'logfc',drop=TRUE])
names(signature) <- rownames(stage_df)
msviper_results_df <- calculate_tf_activities(signature)
msviper_results_list[[stage]] <- msviper_results_df
}
msviper_results_df <- data.frame(tf=unique(Regulon_file$tf))
rownames(msviper_results_df) <- msviper_results_df$tf
for (stage in names(msviper_results_list)) {
tmp <- msviper_results_list[[stage]][,c('nes', 'fdr'),drop=FALSE]
colnames(tmp) <- paste(colnames(tmp), c(stage), sep='_')
msviper_results_df <- merge(msviper_results_df, tmp,
by.x=0, by.y=0, all=TRUE)
rownames(msviper_results_df) <- msviper_results_df$Row.names
msviper_results_df$Row.names <- NULL
}
msviper_results_df[is.na(msviper_results_df)] <- 1
msviper_results_df$tf <- NULL
filename <- paste(output_dir, 'tf_results.tsv', sep='')
write.table(msviper_results_df, file = filename, quote = FALSE, sep='\t')
}
output_dir = '../../results_ucam_sanyal2/discrete_analysis/SAF_score/'
deseq_worker(sorted_conditions, samples_in_conditions, output_dir)
de_analysis_df <- read.csv(paste(output_dir,'de_results.csv', sep=''), row.names=1, sep=',')
output_dir = '../../results_ucam_sanyal2/discrete_analysis/SAF_score/'
deseq_worker(sorted_conditions, samples_in_conditions, output_dir)
de_analysis_df <- read.csv(paste(output_dir,'de_results.csv', sep=''), row.names=1, sep=',')
de_analysis_df <- de_analysis_df[!de_analysis_df$external_gene_name == "",]
dim(de_analysis_df)
# 2A
columns <- colnames(de_analysis_df)[grepl(x=colnames(de_analysis_df), pattern='log2')]
logfc_df <- de_analysis_df[,c(columns,'external_gene_name')]
logfc_df[is.na(logfc_df)] <- 0
logfc_df <- logfc_df[!logfc_df$external_gene_name == "",]
logfc_df <- logfc_df %>%
group_by(external_gene_name) %>%
select(-external_gene_name) %>%
summarise_if(is.numeric, mean)
logfc_df <- as.data.frame(logfc_df)
rownames(logfc_df) <- logfc_df$external_gene_name
logfc_df$external_gene_name <- NULL
colnames(logfc_df) <- c('Mild_vs_Control', 'Moderate_vs_Mild', 'Severe_vs_Moderate')
dim(logfc_df)
# 2B
columns <- colnames(de_analysis_df)[grepl(x=colnames(de_analysis_df), pattern='padj')]
adj_pvalues_df <- de_analysis_df[,c(columns,'external_gene_name')]
adj_pvalues_df[is.na(adj_pvalues_df)] <- 1
adj_pvalues_df <- adj_pvalues_df[!adj_pvalues_df$external_gene_name == "",]
adj_pvalues_df <- adj_pvalues_df %>%
group_by(external_gene_name) %>%
select(-external_gene_name) %>%
summarise_if(is.numeric, pvalue_transformation)
adj_pvalues_df <- as.data.frame(adj_pvalues_df)
rownames(adj_pvalues_df) <- adj_pvalues_df$external_gene_name
adj_pvalues_df$external_gene_name <- NULL
colnames(adj_pvalues_df) <- c('Mild_vs_Control', 'Moderate_vs_Mild', 'Severe_vs_Moderate')
dim(adj_pvalues_df)
msviper_worker(adj_pvalues_df, logfc_df, output_dir)
# Stratification using the NAS score
template_df[,'NAS_score_division'] = template_df[,'NAS']
template_df[,'NAS_score_division']
conditions <- list(
'NAS_0'= 0,
'NAS_1'= 1,
'NAS_2'= 2,
'NAS_3'= 3,
'NAS_4'= 4,
'NAS_5'= 5,
'NAS_6'= 6,
'NAS_7'= 7,
)
sorted_conditions <- paste('NAS_', seq(0,7), collapse='')
sorted_conditions
conditions <- list(
'NAS_0'= 0,
'NAS_1'= 1,
'NAS_2'= 2,
'NAS_3'= 3,
'NAS_4'= 4,
'NAS_5'= 5,
'NAS_6'= 6,
'NAS_7'= 7,
)
conditions <- list(
'NAS_0'= c(0),
'NAS_1'= c(1),
'NAS_2'= c(2),
'NAS_3'= c(3),
'NAS_4'= c(4),
'NAS_5'= c(5),
'NAS_6'= c(6),
'NAS_7'= c(7),
)
conditions
conditions <- list(
'NAS_0'= c(0),
'NAS_1'= c(1),
'NAS_2'= c(2),
'NAS_3'= c(3),
'NAS_4'= c(4),
'NAS_5'= c(5),
'NAS_6'= c(6),
'NAS_7'= c(7),
)
conditions <- list(
'NAS_0'= c(0),
'NAS_1'= c(1),
'NAS_2'= c(2),
'NAS_3'= c(3),
'NAS_4'= c(4),
'NAS_5'= c(5),
'NAS_6'= c(6),
'NAS_7'= c(7)
)
conditions
paste('NAS', seq(1,5))
paste('NAS', seq(1,5), sep='_')
sorted_conditions <- paste('NAS', seq(0,7), sep='_')
sorted_conditions
sorted_conditions <- paste('NAS', seq(0,7), sep='_')
samples_in_conditions <- list()
for (c in names(conditions)) {
tmp <- template_df[template_df[,'NAS_score_division'] %in% patient_classes[[c]],]
samples_in_conditions[[c]] <- rownames(tmp)
}
samples_in_conditions
template_df[template_df[,'NAS_score_division'] %in% patient_classes[[c]],]
c
sorted_conditions <- paste('NAS', seq(0,7), sep='_')
samples_in_conditions <- list()
for (c in names(conditions)) {
tmp <- template_df[template_df[,'NAS_score_division'] %in% conditions[[c]],]
samples_in_conditions[[c]] <- rownames(tmp)
}
samples_in_conditions
template_df[which(template_df$NAS == 7),]
samples_in_conditions
sorted_conditions
output_dir = '../../results_ucam_sanyal2/discrete_analysis/NAS_score/'
deseq_worker(sorted_conditions, samples_in_conditions, output_dir)
de_analysis_df <- read.csv(paste(output_dir,'de_results.csv', sep=''), row.names=1, sep=',')
de_analysis_df <- de_analysis_df[!de_analysis_df$external_gene_name == "",]
dim(de_analysis_df)
# 2A
columns <- colnames(de_analysis_df)[grepl(x=colnames(de_analysis_df), pattern='log2')]
logfc_df <- de_analysis_df[,c(columns,'external_gene_name')]
logfc_df[is.na(logfc_df)] <- 0
logfc_df <- logfc_df[!logfc_df$external_gene_name == "",]
logfc_df <- logfc_df %>%
group_by(external_gene_name) %>%
select(-external_gene_name) %>%
summarise_if(is.numeric, mean)
logfc_df <- as.data.frame(logfc_df)
rownames(logfc_df) <- logfc_df$external_gene_name
logfc_df$external_gene_name <- NULL
colnames(logfc_df) <- c('Mild_vs_Control', 'Moderate_vs_Mild', 'Severe_vs_Moderate')
dim(logfc_df)
# 2B
columns <- colnames(de_analysis_df)[grepl(x=colnames(de_analysis_df), pattern='padj')]
adj_pvalues_df <- de_analysis_df[,c(columns,'external_gene_name')]
adj_pvalues_df[is.na(adj_pvalues_df)] <- 1
adj_pvalues_df <- adj_pvalues_df[!adj_pvalues_df$external_gene_name == "",]
adj_pvalues_df <- adj_pvalues_df %>%
group_by(external_gene_name) %>%
select(-external_gene_name) %>%
summarise_if(is.numeric, pvalue_transformation)
adj_pvalues_df <- as.data.frame(adj_pvalues_df)
rownames(adj_pvalues_df) <- adj_pvalues_df$external_gene_name
adj_pvalues_df$external_gene_name <- NULL
colnames(adj_pvalues_df) <- c('Mild_vs_Control', 'Moderate_vs_Mild', 'Severe_vs_Moderate')
dim(adj_pvalues_df)
msviper_worker(adj_pvalues_df, logfc_df, output_dir)
View(logfc_df)
View(logfc_df)
output_dir
de_analysis_df <- read.csv(paste(output_dir,'de_results.csv', sep=''), row.names=1, sep=',')
de_analysis_df <- de_analysis_df[!de_analysis_df$external_gene_name == "",]
dim(de_analysis_df)
de_analysis_df
columns <- colnames(de_analysis_df)[grepl(x=colnames(de_analysis_df), pattern='log2')]
logfc_df <- de_analysis_df[,c(columns,'external_gene_name')]
logfc_df[is.na(logfc_df)] <- 0
logfc_df <- logfc_df[!logfc_df$external_gene_name == "",]
logfc_df <- logfc_df %>%
group_by(external_gene_name) %>%
select(-external_gene_name) %>%
summarise_if(is.numeric, mean)
logfc_df <- as.data.frame(logfc_df)
rownames(logfc_df) <- logfc_df$external_gene_name
logfc_df$external_gene_name <- NULL
saaply(colnames(logfc_df), function(c) {
gsub('_log2FoldChange', '', c)
}, USE.NAMES=FALSE)
sapply(colnames(logfc_df), function(c) {
gsub('_log2FoldChange', '', c)
}, USE.NAMES=FALSE)
colnames(logfc_df) <- sapply(colnames(logfc_df), function(c) {
gsub('_log2FoldChange', '', c)
}, USE.NAMES=FALSE)
dim(logfc_df)
columns <- colnames(de_analysis_df)[grepl(x=colnames(de_analysis_df), pattern='padj')]
adj_pvalues_df <- de_analysis_df[,c(columns,'external_gene_name')]
adj_pvalues_df[is.na(adj_pvalues_df)] <- 1
adj_pvalues_df <- adj_pvalues_df[!adj_pvalues_df$external_gene_name == "",]
adj_pvalues_df <- adj_pvalues_df %>%
group_by(external_gene_name) %>%
select(-external_gene_name) %>%
summarise_if(is.numeric, pvalue_transformation)
adj_pvalues_df <- as.data.frame(adj_pvalues_df)
rownames(adj_pvalues_df) <- adj_pvalues_df$external_gene_name
adj_pvalues_df$external_gene_name <- NULL
adj_pvalues_df
adj_pvalues_df$external_gene_name <- NULL
# 2B
columns <- colnames(de_analysis_df)[grepl(x=colnames(de_analysis_df), pattern='padj')]
adj_pvalues_df <- de_analysis_df[,c(columns,'external_gene_name')]
adj_pvalues_df[is.na(adj_pvalues_df)] <- 1
adj_pvalues_df <- adj_pvalues_df[!adj_pvalues_df$external_gene_name == "",]
adj_pvalues_df <- adj_pvalues_df %>%
group_by(external_gene_name) %>%
select(-external_gene_name) %>%
summarise_if(is.numeric, pvalue_transformation)
adj_pvalues_df <- as.data.frame(adj_pvalues_df)
rownames(adj_pvalues_df) <- adj_pvalues_df$external_gene_name
adj_pvalues_df$external_gene_name <- NULL
colnames(adj_pvalues_df) <- sapply(colnames(adj_pvalues_df), function(c) {
gsub('_padj', '', c)
}, USE.NAMES=FALSE)
View(adj_pvalues_df)
View(adj_pvalues_df)
msviper_worker(adj_pvalues_df, logfc_df, output_dir)
